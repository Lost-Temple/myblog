---
title: 重读《JAVA与模式》笔记系列-00002
tags:
  - 开闭原则
  - OCP
categories:
  - 设计模式
  - 基本概念
cover: 'https://s2.loli.net/2022/12/17/YaZy9QmPK6bSWsX.png'
abbrlink: 51585
date: 2022-12-17 14:58:27
---

# 什么是“开-闭”原则
“开-闭”原则讲的是：一个软件实体应当对扩展开放，对修改关闭。
>Software entities should be open for extension, but closed for modification.

这个原则说的是，在设计一个模块的时候，应当使这个模块可以在不被修改的前提下被扩展。换言之，应当可以在不必修改源代码的情况下改变这个模块的行为。

满足“开-闭”原则的设计可以给一个软件系统两个无可比拟的优越性：
- 通过扩展已有的软件系统，可以提供新的行为，以满足对软件的新需求，使变化中的软件系统中有一定的适应性和灵活性。
- 已有的软件模块，特别是最重要的抽象层模块不能再修改，这就使变化中的软件系统有一定的稳定性和延续性。

# 抽象化是关键
解决问题的关键在于抽象化。面向对象的编程语言里面，可以给系统定义出一个一劳永逸、不再更改的抽象设计，此设计允许有无穷无尽的行为在实现层被实现。这个抽象层预见了所有的可能扩展，因此，在任何扩展情况下都不会改变。这就使得系统的抽象层不需修改，从而满足了“开-闭”原则的第二条：对修改关闭。

同时，由于从抽象层导出一个或多个新的具体类可以改变系统的行为，因此系统的设计对扩展是开放的，这就满足了“开-闭”原则的第一条。

# 对可变性的封装原则
“开-闭”原则如果从另外一个角度讲述，就是所谓的“对可变性的封装原则”（Principle of Encapsulation of Variation，常常略写做EVP)."

可变性原则的思路：考虑的不是什么会导致设计改变，而是考虑你允许什么发生变化而不让这一变化导致重新设计。

[SHALL01]将这一思想用一句话总结为：找到一个系统的可变因素，将它封装起来，并将它命名为“对可变性的封装原则”，对可变性的封装原则意味着两点：
- 一种可变性不应当散落在代码的很多角落里，而应当被封装到一个对象里面。同一种可变性的不同表象意味着同一继承等级结构中的具体子类。
- 一种可变性不应当与另一种可变性混合在一起。即类图中的继承结构一般都不会超过两层。不然就意味着将两种不同的可变性混合在了一起。

>显然，”对可变性的封装原则“从工程的角度讲解了如何实现”开-闭“原则。

# 与其它设计原则的关系
做到”开-闭“原则不是一件容易的事，但是也是有很多规律可循的。这些规律也同样以设计原则的身份出现，但是它们都是”开-闭“原则的手段和工具，是附属于”开-闭“原则的。

## 里氏代换原则
**里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。**

里氏代换原则是对”开-闭“原则的补充。正如前面所谈到的，实现”开-闭“原则的关键步骤就是抽象化。而基类与子类的继承关系就是抽象化的具体体现，所以里氏代换原则是对实现抽象化的具体步骤的规范。

一般而言，违反里氏代换原则的，也违背”开-闭“原则，反过来并不一定成立。

## 依赖倒转原则
**依赖倒转原则讲的是，要依赖于抽象，不要依赖于实现。**

看上去和”开-闭”原则有很大的相似之处，实际上，它们之间的关系是目标和手段的关系。“开-闭”原则是目标，而达到这一目标的手段是依赖倒转原则。

换言之，要想实现“开-闭”原则，就应当坚持依赖倒转原则，违反依赖倒转原则，就不可能达到“开-闭”原则的要求。

## 合成/聚合复用原则
**合成/聚合复用原则讲的是，要尽量使用合成/聚合，而不是继承关系达到复用的目的。**

合成/聚合复用原则是与里氏代换原则相辅相成的，两者又都是对实现“开-闭”原则的具体步骤的规范。

遵守合成/聚合复用原则是实现“开-闭”原则的必要条件；违反了这一原则就无法使系统实现“开-闭”原则这一目标。

## 迪米特法则
**迪米特法则讲的是，一个软件实体应当与尽可能少的其它实体发生相互作用。**

当一个系统面临功能扩展时，其中会有一些模块，它们需要修改的压力比其它一些模块要大。最后的结果可能是这些模块需要修改或者不需要修改。但是不论是哪一种情况，如果这些模块是相对孤立的，那么它们就不会将修改的压力传递给其它的模块。

这就是说，一个遵守迪米特原则设计出来的系统在功能需要扩展时，会相对更容易地做到对修改的半闭。也就是说，迪米特法则是一条通向“开-闭”原则的道路。

## 接口隔离原则
**接口隔离原则讲的是，应当为客户端提供尽可能小的单独接口，而不要提供大的总接口。**

显然，接口隔离原则与广义的迪米特法则都是对一个软件实体与其它的软件实体的通信的限制。广义的迪米特法则要求尽可能限制通信的宽度和深度。接口隔离原则所限制的是通信的宽度，也就是说，通信应当尽可能地窄。

遵循隔离原则与迪米特法则，会使一个软件系统在功能扩展的过程当中，不会将修改的压力传递到其它对象。

